{% extends 'base.html' %}

{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="container mt-4">
    {% include 'partials/_messages.html' with messages=messages %}
    <div class="row justify-content-center mb-5">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-danger text-white text-center">
                    <div class="mb-0">
                        <i class="fas fa-user-edit me-2"></i>
                        <span class="fw-semibold">UPDATE PROFILE</span>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        {% if obj.profile_picture %}
                        <div class="text-center mb-4">
                            <img src="{{ obj.profile_picture.url }}" alt="Current profile picture" class="img-thumbnail rounded-circle"
                                style="width: 120px; height: 120px; object-fit: cover;">
                        </div>
                        {% endif %}
                        <h5 class="text-danger mb-0">PROFILE INFO</h5>
                        <hr class="mb-4 mt-1">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">
                                    First Name <span class="text-danger">*</span>
                                </label>
                                {{ form.first_name }}
                                {% if form.first_name.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.first_name.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">
                                    Last Name <span class="text-danger">*</span>
                                </label>
                                {{ form.last_name }}
                                {% if form.last_name.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.last_name.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">
                                    Email <span class="text-danger">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.email.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Phone Number</label>
                                {{ form.phone_number }}
                                {% if form.phone_number.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.phone_number.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Birth Date</label>
                                {{ form.birthdate }}
                                {% if form.birthdate.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.birthdate.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Country</label>
                                {{ form.country }}
                                {% if form.country.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.country.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Facebook Profile</label>
                                {{ form.facebook_profile }}
                                <div class="form-text">Enter your complete Facebook profile URL</div>
                                {% if form.facebook_profile.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.facebook_profile.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold">Update Profile Picture</label>
                                {{ form.profile_picture }}
                                <div class="form-text">Upload a new profile picture (JPG, PNG)</div>
                                {% if form.profile_picture.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.profile_picture.errors %}
                                    <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <h5 class="text-danger mb-0 mt-4">DANGER ZONE</h5>
                        <hr class="mb-4 mt-1">
                        <div class="alert alert-danger" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Warning:</strong> Deleting your account is permanent and cannot be undone. All your personal information, project contributions, donations, and
                            account history will be permanently erased from our system. Before proceeding, please ensure you have saved any important information you might need in
                            the future.
                        </div>
                        <div class="d-flex align-items-center justify-content-center">
                            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                <i class="fas fa-trash me-1"></i>
                                <span>I UNDERSTAND, I WISH TO DELETE MY ACCOUNT</span>
                            </button>
                        </div>

                        <hr class="my-4">

                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <button type="submit" class="btn btn-success me-2">
                                    <i class="fas fa-save me-1"></i>
                                    <span>Save Changes</span>
                                </button>
                                <a href="{% url 'profile' %}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left me-1"></i>
                                    <span>Take me back</span>
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form class="modal-content" action="{% url 'profile_delete' %}" method="post" id="delete-account-form">
            {% csrf_token %}
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteAccountModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Delete Account
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 3rem;"></i>
                    <h5 class="text-danger mb-3">Are you absolutely sure?</h5>
                    <div class="alert alert-danger text-start" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> Deleting your account is permanent and cannot be undone. All your personal information, project contributions, donations, and
                        account history will be permanently erased from our system. Before proceeding, please ensure you have saved any important information you might need in
                        the future.
                    </div>
                </div>
                <label for="password-field" class="form-label">Enter your password</label>
                <input type="password" class="form-control" placeholder="Enter your password to delete your account" name="password" id="password-field" required />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                    <i class="fas fa-arrow-left me-1"></i>
                    <span>Take me back</span>
                </button>
                <button type="submit" class="btn btn-danger" id="confirm-delete-btn">
                    <i class="fas fa-trash me-1"></i>
                    <span>Yes, delete my account</span>
                </button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    $()
</script>
{% endblock scripts %}